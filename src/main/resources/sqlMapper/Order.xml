<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="OrderMapper">
    <insert id="insertOrder" parameterType="Order">
        <selectKey keyProperty="orderId" resultType="int" order="BEFORE">
            SELECT C##DEV.ORDERS_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO ORDERS (
            order_id,
            room_member_id,
            order_type,
            order_total_quantity,
            order_price,
            stock_code
        )
        VALUES (
                   #{orderId},
                   #{roomMemberId},
                   #{orderType},
                   #{orderTotalQuantity},
                   #{orderPrice},
                   #{stockCode}
               )
    </insert>

    <select id="selectOrderById" resultType="Member" parameterType="String">
        SELECT *
        FROM ORDERS
        WHERE order_id = #{id}
    </select>

    <select id="countTotalQuantityByRoomMemberIdAndStockCode" parameterType="Order" resultType="int">
        SELECT NVL(SUM(order_total_quantity * DECODE(order_type, 'SELL', -1, 1)), 0) AS total_quantity
        FROM ORDERS
        WHERE room_member_id = #{roomMemberId}
        AND stock_code = #{stockCode}
    </select>
</mapper>
